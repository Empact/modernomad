{% extends "root.html" %}
{% load staticfiles %}

{% block body %}

<div class="container">

{% if messages %}
<div class="messages">
	{% for message in messages %}
	<div class="alert alert-info">
		<button type="button" class="close" data-dismiss="alert">Ã—</button>
		<div {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
	</div>
	{% endfor %}
</div>
{% endif %}

{% if not user.is_authenticated %}
	<h2>Register a new account</h2>

	<p>If you already have an account, you can <a href="/people/login?next=/reservation/create/">log in</a> instead. </p>
{% else %}
	<h2>Tell us about yourself</h2>
{% endif %}

<p class="lead">Your profile tells us and others a little bit about who you are, what you are passionate
about, and possible connections around work, projects and ideas. It should only take about
5 minutes, but will help in connecting with the other awesome people around the space.</p>

<hr>

<form class="cropping_image_container">
{% if has_image %}
	<p id="img-upload-instruction">Update your Profile image here (optional).</p>
{% else %}
	<p id="img-upload-instruction">Upload an image for your profile (required).</p>
{% endif %}
<p id="img-upload-error"></p>
<div>
<input type="file" id="imageLoader" name="imageLoader"/>
<button id="crop-button" onclick="cropThat.getResults()" hidden>Crop</button>
</div>
<div>
  <canvas class="cropping_image img-polaroid" id="imageCanvas"></canvas>
  <div class="crop-result-wrapper">
	  <h3 id="cropped-header">Your image:</h3>
	<img class="img-polaroid" id="crop-result" />
  </div>
  <div class="clear">
  </div>
</div>
</form>


<form id="newprofileform" class="" enctype="multipart/form-data" method="post">{% csrf_token %}
	{% for field in form %}
		<div class="form-group">
			{% if field.name != "image" %}
				{{ field.errors }}
				{{ field.label_tag }}
				<span class="form-help-text">{{ field.help_text}}</span>
				<div class="form-field-body">
				{% if field.field.required %} * {% endif %}
				{{ field }}
				</div>
			{% else %}
				{{ field.errors }}
				<input type="hidden" name="image" id="id_image">
			{% endif %}
		</div>
	{% endfor %}
  <input id="profilesubmit" type="submit" value="Submit" />
</form>

{% endblock %}

{% block extrajs %}
	<script src="{% static 'js/imgcrop.js' %}"></script>
	<script>
		$("#newprofileform").submit(function (e) {
			if ('{{ has_image }}' != 'True' && ! $("#id_image").val() ) {
				$("#img-upload-error").html('<div class="alert alert-danger"><span class="glyphicon glyphicon-exclamation-sign"></span> An image is required.</div>');
				$('html,body').animate({ scrollTop: $("#img-upload-error").offset().top - 20})
				return false;
			}
		}) 

	</script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>
	<script>
		$("#id_city").keyup(function() {
			autocomplete = new google.maps.places.Autocomplete(this);
			google.maps.event.addListener(autocomplete, 'place_changed', function() {
				var place = autocomplete.getPlace();
				console.log(place);
				console.log(place.address_components);

			});
		});
	</script>
</div>
{% endblock %}

